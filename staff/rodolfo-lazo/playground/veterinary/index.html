<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Veterinary</title>
  </head>

  <body style="background-color: black">
    <script>
      function User(id, name, surname, username, password, role) {
        this.id = id;
        this.name = name;
        this.surname = surname;
        this.username = username;
        this.password = password;
        this.role = role;
      }

      function Vaccine(id, name, description) {
        this.id = id;
        this.name = name;
        this.description = description;
      }

      function Owner(id, passport, name, surname, address, phone, email) {
        this.id = id;
        this.passport = passport;
        this.name = name;
        this.surname = surname;
        this.address = address;
        this.phone = phone;
        this.email = email;
        this.active = true;
      }

      function Pet(
        ownerId,
        id,
        passport,
        name,
        yearOfBirth,
        species,
        gender,
        race,
        colors
      ) {
        this.ownerId = ownerId;
        this.id = id;
        this.passport = passport;
        this.name = name;
        this.yearOfBirth = yearOfBirth;
        this.species = species;
        this.gender = gender;
        this.race = race;
        this.colors = colors;
        this.vaccines = []; // { vaccineId: 'rst-456', expirationDate: '2026-01-01' }
      }

      Pet.prototype.saveVaccine = function (vaccineId, expirationDate) {
        this.vaccines.push({
          vaccineId: vaccineId,
          expirationDate: expirationDate,
        });
      };

      function Database() {
        this.users = [];
        this.usersCount = 0;
        this.petsCount = 0;
        this.vaccines = [];
        this.owners = [];
        this.ownersCount = 0;
        this.pets = [];
      }

      // users

      Database.prototype.addUser = function (user) {
        this.users.push(user);
        this.usersCount++;
      };

      Database.prototype.findUserByUsername = function (username) {
        for (let i = 0; i < this.users.length; i++) {
          const user = this.users[i];

          if (user.username === username) return user;
        }

        return null;
      };

      // vaccines

      Database.prototype.addVaccine = function (vaccine) {
        this.vaccines.push(vaccine);
      };

      // owners

      Database.prototype.addOwner = function (owner) {
        this.owners.push(owner);
        this.ownersCount++;
      };

      Database.prototype.findOwnerById = function (ownerId) {
        for (let i = 0; i < this.owners.length; i++) {
          const owner = this.owners[i];

          if (owner.id === ownerId) return owner;
        }

        return null;
      };

      Database.prototype.findOwnerByPassport = function (ownerPassport) {
        for (let i = 0; i < this.owners.length; i++) {
          const owner = this.owners[i];

          if (owner.passport === ownerPassport) return owner;
        }

        return null;
      };

      Database.prototype.addPet = function (pet) {
        this.pets.push(pet);
      };

      Database.prototype.findPetsByOwnerId = function (ownerId) {
        const foundPets = [];

        for (let i = 0; i < this.pets.length; i++) {
          const pet = this.pets[i];

          if (pet.ownerId === ownerId) foundPets.push(pet);
        }

        return foundPets;
      };

      Database.prototype.findPetById = function (petId) {
        for (let i = 0; i < this.pets.length; i++) {
          const pet = this.pets[i];

          if (pet.id === petId) return pet;
        }

        return null;
      };

      Database.prototype.findPetByPassport = function (passport) {
        for (let i = 0; i < this.pets.length; i++) {
          const pet = this.pets[i];

          if (pet.passport === passport) return pet;
        }

        return null;
      };

      const data = new Database();

      /*
        LOGICA DE NEGOCIO
      */

      function Logic() {}

      Logic.prototype.registerUser = function (
        name,
        surname,
        username,
        password,
        passwordRepeat,
        role
      ) {
        if (typeof name !== "string") return "invalid name type";
        if (name.length < 1) return "invalid name length";

        if (typeof surname !== "string") return "invalid surname type";
        if (surname.length < 2) return "invalid surname length";

        if (typeof username !== "string") return "invalid username type";
        if (username.length < 4) return "invalid username length";

        if (typeof password !== "string") return "invalid password type";
        if (password.length < 8) return "invalid password length";

        if (typeof passwordRepeat !== "string")
          return "invalid passwordRepeat type";
        if (passwordRepeat.length < 8) return "invalid passwordRepeat length";

        if (password !== passwordRepeat) return "passwords do not match";

        if (typeof role !== "string") return "invalid role type";
        if (role !== "auxiliar" && role !== "veterinary")
          return "invalid role value";

        let user = data.findUserByUsername(username);

        if (user !== null) return "user already exists";

        user = new User(
          "user-" + data.usersCount,
          name,
          surname,
          username,
          password,
          role
        );

        data.addUser(user);
      };

      Logic.prototype.registerOwner = function (
        passport,
        name,
        surname,
        address,
        phone,
        email
      ) {
        if (typeof passport !== "string") return "invalid passport type";
        if (passport.length < 6) return "invalid passport length";

        if (typeof name !== "string") return "invalid name type";
        if (name.length < 1) return "invalid name length";

        if (typeof surname !== "string") return "invalid surname type";
        if (surname.length < 2) return "invalid surname length";

        if (typeof address !== "string") return "invalid address type";
        if (address.length < 5) return "invalid address length";

        if (typeof phone !== "string") return "invalid phone type";
        if (phone.length < 5) return "invalid phone length";

        if (typeof email !== "string") return "invalid email type";
        if (email.length < 6) return "invalid email length";

        let owner = data.findOwnerByPassport(passport);

        if (owner !== null) return "owner already exists";

        owner = new Owner(
          "owner-" + data.ownersCount,
          passport,
          name,
          surname,
          address,
          phone,
          email
        );

        data.addOwner(owner);
      };

      Logic.prototype.registerPet = function (
        ownerId,
        passport,
        name,
        yearOfBirth,
        species,
        gender,
        race,
        colors
      ) {
        if (typeof name !== "string" || name.length < 1)
          return "invalid name type";
        if (typeof passport !== "string") return "invalid passport type";
        if (
          typeof yearOfBirth !== "number" &&
          yearOfBirth > 1990 &&
          yearOfBirth < 2026
        )
          return "invalid yearOfBirth type";
        if (typeof species !== "string" || species.length < 3)
          return "invalid species type";
        if (
          typeof gender !== "string" ||
          (gender !== "male" && gender !== "female")
        )
          return "invalid gender value";
        if (typeof race !== "string" || race.length < 3)
          return "invalid race type";

        if (typeof colors !== "string" || colors.length < 3)
          return "invalid colors type";

        let pet = data.findPetByPassport(passport);
        if (pet !== null) return "pet already exists";

        pet = new Pet(
          ownerId,
          "pet-" + data.petsCount,
          passport,
          name,
          yearOfBirth,
          species,
          gender,
          race,
          colors
        );

        data.addPet(pet);
        data.petsCount++;
      };

      const logic = new Logic();
    </script>
  </body>
</html>
